%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#76B900', 'primaryTextColor': '#fff', 'lineColor': '#333'}}}%%

flowchart TB
    START(("ğŸš€ Start"))

    subgraph S1["Step 1: Prerequisites"]
        CHECK["00-setup-check.sh<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Docker<br/>âœ“ NVIDIA Runtime<br/>âœ“ GPU Detection<br/>âœ“ Disk Space<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â±ï¸ ~30 seconds"]
    end

    subgraph S2["Step 2: Authentication"]
        LOGIN["01-ngc-login.sh<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ NGC Login<br/>ğŸ“¦ Pull Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â±ï¸ ~1 minute"]
    end

    subgraph S3["Step 3: Data Download"]
        DOWNLOAD["02-download-data.sh<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â¬‡ï¸ GIAB HG002 FASTQ<br/>ğŸ”€ Lane Merging<br/>âœ… Read Validation<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â±ï¸ 2-6 hours"]
    end

    subgraph S4["Step 4: Reference Setup"]
        REFERENCE["03-setup-reference.sh<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â¬‡ï¸ Parabricks Bundle<br/>ğŸ“‚ Extract GRCh38<br/>ğŸ“‘ BWA Index<br/>ğŸ”§ FASTA Index<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â±ï¸ 5-15 minutes"]
    end

    subgraph S5["Step 5: Chr20 Test"]
        TEST["04-run-chr20-test.sh<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ§¬ fq2bam (chr20)<br/>ğŸ“Š BAM Index + QC<br/>ğŸ§  DeepVariant<br/>ğŸ“‘ VCF Index<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â±ï¸ 5-20 minutes"]
    end

    subgraph S6["Step 6: Full Genome"]
        FULL["05-run-full-genome.sh<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ§¬ fq2bam (all chr)<br/>ğŸ“Š BAM Index + QC<br/>ğŸ§  DeepVariant<br/>ğŸ“‘ VCF Index<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â±ï¸ 120-240 minutes"]
    end

    subgraph OUT["ğŸ“¤ Outputs"]
        direction LR
        BAM["ğŸ“ HG002.genome.bam<br/>~100GB"]
        VCF["ğŸ“ HG002.genome.vcf.gz<br/>~1-2GB"]
    end

    DONE(("âœ… Complete"))

    START --> S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> OUT --> DONE

    %% Styling
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:2px,color:#fff
    classDef stepBox fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef outputBox fill:#FFF3E0,stroke:#F57C00,stroke-width:2px

    class START,DONE startEnd
    class S1,S2,S3,S4,S5,S6 stepBox
    class OUT outputBox
